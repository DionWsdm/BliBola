{% extends 'base.html' %}

{% block content %}
<div class="w-full min-h-screen bg-[#181818] text-white py-10 px-6">

  <!-- Back Button -->
  <div class="mb-6">
    <a href="{% url 'main:show_main' %}" 
       class="inline-flex items-center px-4 py-2 bg-[#2A2A2A] border border-[#4A4A4A] text-gray-300 rounded-lg hover:bg-green-600 hover:text-white transition-colors">
      ‚Üê Back to Product List
    </a>
  </div>

  <!-- Product Detail Card -->
  <div id="product-card" class="max-w-4xl mx-auto bg-[#1F1F1F] rounded-2xl shadow-lg border border-[#2F2F2F] p-8">
    <div id="loading" class="text-center text-gray-400 text-lg">Loading product details...</div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const productId = window.location.pathname.split("/").filter(Boolean).pop();
  const DETAIL_ENDPOINT = "{% url 'main:show_json_by_id' 'REPLACE_ID' %}".replace("REPLACE_ID", productId);
  console.log("productId: "+productId)
  fetch(DETAIL_ENDPOINT)
    .then(response => {
      if (!response.ok) throw new Error("Failed to fetch product data");
      return response.json();
    })
    .then(data => {
      const product = data[0];
      const card = document.getElementById("product-card");

      card.innerHTML = `
        <h1 class="text-3xl font-bold mb-2">${product.name}</h1>
        <p class="text-gray-400 mb-4">
          <span class="font-semibold text-green-500">${product.category}</span>
          ${product.is_featured ? '| <span class="text-yellow-400 font-semibold">Featured</span>' : ''}
          | <span class="text-sm">Stock: ${product.stock}</span>
        </p>

        ${product.thumbnail ? `
          <div class="w-full mb-6 flex justify-center">
            <img src="${product.thumbnail}" alt="product thumbnail" class="rounded-xl shadow-lg max-h-96 object-cover">
          </div>
        ` : ''}

        <div class="prose prose-invert max-w-none mb-6">
          <p class="text-lg leading-relaxed text-gray-200">${product.description}</p>
          <div class="mt-4">${product.content ?? ''}</div>
        </div>

        <div class="mt-6 flex items-center gap-3 text-gray-300">
          <p>Seller: ${product.user || 'Anonymous'}</p>
        </div>
      `;
    })
    .catch(err => {
      console.error(err);
      document.getElementById("product-card").innerHTML = `
        <div class="text-center text-red-500">Failed to load product data.</div>
      `;
    });
});
</script>
{% endblock content %}